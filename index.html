<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Another Chess - Modern Chess Game</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>♔</text></svg>">
    <!-- Add chess.js library - using CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">♔ Another Chess</h1>
            <div class="game-controls">
                <button id="newGameBtn" class="btn btn-primary">New Game</button>
                <button id="flipBoardBtn" class="btn btn-secondary">Flip Board</button>
                <button id="settingsBtn" class="btn btn-secondary">Settings</button>
                <button id="helpBtn" class="btn btn-secondary">Help</button>
            </div>
        </header>

        <main class="game-area">
            <div class="game-info">
                <div class="player-info">
                    <div class="player" id="topPlayer">
                        <div class="player-name">AI Opponent</div>
                        <div class="captured-pieces" id="topCaptured"></div>
                    </div>
                </div>
                
                <div class="chess-board-container">
                    <div class="board-wrapper">
                        <div class="coordinates coordinates-left">
                            <div class="coord">8</div>
                            <div class="coord">7</div>
                            <div class="coord">6</div>
                            <div class="coord">5</div>
                            <div class="coord">4</div>
                            <div class="coord">3</div>
                            <div class="coord">2</div>
                            <div class="coord">1</div>
                        </div>
                        <div class="board-area">
                            <div id="chessBoard" class="chess-board"></div>
                            <div class="coordinates coordinates-bottom">
                                <div class="coord">a</div>
                                <div class="coord">b</div>
                                <div class="coord">c</div>
                                <div class="coord">d</div>
                                <div class="coord">e</div>
                                <div class="coord">f</div>
                                <div class="coord">g</div>
                                <div class="coord">h</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="game-info">
                    <div class="player-info">
                        <div class="player" id="bottomPlayer">
                            <div class="player-name">You</div>
                            <div class="captured-pieces" id="bottomCaptured"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="game-sidebar">
                <div class="game-status">
                    <div class="status-item">
                        <span class="status-label">Turn:</span>
                        <span id="currentTurn" class="status-value">White</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Mode:</span>
                        <span id="gameMode" class="status-value">vs AI</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Difficulty:</span>
                        <span id="difficulty" class="status-value">Medium</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Time:</span>
                        <span id="gameTime" class="status-value">0:00</span>
                    </div>
                </div>

                <div class="game-statistics">
                    <h3>Game Statistics</h3>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Moves:</span>
                            <span id="totalMoves" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Captures:</span>
                            <span id="captures" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Checks:</span>
                            <span id="checks" class="stat-value">0</span>
                        </div>
                    </div>
                </div>

                <div class="move-history">
                    <h3>Move History</h3>
                    <div id="moveList" class="move-list"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Game Over Modal -->
    <div id="gameOverModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="gameOverTitle">Game Over</h2>
                <button class="close-btn" id="closeGameOver">&times;</button>
            </div>
            <div class="modal-body">
                <div class="game-over-content">
                    <p id="gameOverMessage">Game has ended!</p>
                    <div class="game-over-stats">
                        <div class="stat-item">
                            <span class="stat-label">Total Moves:</span>
                            <span id="finalMoves" class="stat-value">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Game Time:</span>
                            <span id="finalTime" class="stat-value">0:00</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Captures:</span>
                            <span id="finalCaptures" class="stat-value">0</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="playAgainBtn" class="btn btn-primary">Play Again</button>
                <button id="exportGameBtn" class="btn btn-secondary">Export Game</button>
            </div>
        </div>
    </div>

    <script>
        // Simple Chess Game - Minimal Version
        let chess = null;
        let selectedSquare = null;
        let gameStats = {
            totalMoves: 0,
            captures: 0,
            checks: 0,
            startTime: Date.now()
        };

        // Initialize game
        function initGame() {
            console.log('Initializing chess game...');
            
            // Check if Chess.js is loaded
            if (typeof Chess === 'undefined') {
                console.error('Chess.js library not loaded!');
                document.getElementById('chessBoard').innerHTML = '<div style="color: red; padding: 20px;">Chess.js failed to load</div>';
                return;
            }

            try {
                chess = new Chess();
                console.log('Chess.js initialized successfully');
                console.log('Initial FEN:', chess.fen());
                
                createBoard();
                updatePieces();
                updateDisplay();
                bindEvents();
                
                console.log('Game initialized successfully');
            } catch (error) {
                console.error('Error initializing game:', error);
                document.getElementById('chessBoard').innerHTML = '<div style="color: red; padding: 20px;">Error: ' + error.message + '</div>';
            }
        }

        // Create chess board
        function createBoard() {
            const boardElement = document.getElementById('chessBoard');
            boardElement.innerHTML = '';
            
            for (let row = 0; row < 8; row++) {
                for (let col = 0; col < 8; col++) {
                    const square = document.createElement('div');
                    square.className = 'square';
                    square.dataset.row = row;
                    square.dataset.col = col;
                    
                    // Add square coloring
                    if ((row + col) % 2 === 0) {
                        square.style.backgroundColor = '#f0d9b5';
                    } else {
                        square.style.backgroundColor = '#b58863';
                    }
                    
                    square.addEventListener('click', handleSquareClick);
                    boardElement.appendChild(square);
                }
            }
            
            console.log('Board created with', boardElement.children.length, 'squares');
        }

        // Update pieces on board
        function updatePieces() {
            console.log('Updating pieces...');
            
            const squares = document.querySelectorAll('.square');
            squares.forEach(square => {
                const row = parseInt(square.dataset.row);
                const col = parseInt(square.dataset.col);
                
                // Clear previous piece
                square.innerHTML = '';
                
                // Get piece from chess.js
                const algebraic = rowColToAlgebraic(row, col);
                const piece = chess.get(algebraic);
                
                if (piece) {
                    const pieceElement = document.createElement('div');
                    pieceElement.className = 'piece';
                    pieceElement.innerHTML = getPieceSymbol(piece);
                    
                    if (piece.color === 'w') {
                        pieceElement.style.color = '#ffffff';
                        pieceElement.style.textShadow = '0 0 10px rgba(255,255,255,0.8), 0 2px 4px rgba(0,0,0,0.8)';
                    } else {
                        pieceElement.style.color = '#2a2a2a';
                        pieceElement.style.textShadow = '0 0 10px rgba(255,215,0,0.6), 0 2px 4px rgba(0,0,0,0.8)';
                    }
                    
                    square.appendChild(pieceElement);
                }
            });
            
            console.log('Pieces updated');
        }

        // Get piece symbol
        function getPieceSymbol(piece) {
            const symbols = {
                'p': { 'w': '♙', 'b': '♟' },
                'r': { 'w': '♖', 'b': '♜' },
                'n': { 'w': '♘', 'b': '♞' },
                'b': { 'w': '♗', 'b': '♝' },
                'q': { 'w': '♕', 'b': '♛' },
                'k': { 'w': '♔', 'b': '♚' }
            };
            return symbols[piece.type][piece.color] || '?';
        }

        // Convert row/col to algebraic notation
        function rowColToAlgebraic(row, col) {
            const files = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];
            const ranks = ['8', '7', '6', '5', '4', '3', '2', '1'];
            return files[col] + ranks[row];
        }

        // Handle square click
        function handleSquareClick(event) {
            const square = event.currentTarget;
            const row = parseInt(square.dataset.row);
            const col = parseInt(square.dataset.col);
            const algebraic = rowColToAlgebraic(row, col);
            
            console.log('Square clicked:', algebraic, 'Row:', row, 'Col:', col);
            
            if (selectedSquare) {
                // Try to make a move
                const from = rowColToAlgebraic(selectedSquare.row, selectedSquare.col);
                const to = algebraic;
                
                console.log('Attempting move from', from, 'to', to);
                
                try {
                    const move = chess.move({ from, to, promotion: 'q' });
                    
                    if (move) {
                        console.log('Move successful:', move);
                        gameStats.totalMoves++;
                        
                        if (move.captured) {
                            gameStats.captures++;
                        }
                        
                        clearSelection();
                        updatePieces();
                        updateDisplay();
                        
                        // AI move
                        setTimeout(makeAIMove, 500);
                    } else {
                        console.log('Invalid move');
                        clearSelection();
                        selectSquare(row, col);
                    }
                } catch (error) {
                    console.log('Move error:', error);
                    clearSelection();
                    selectSquare(row, col);
                }
            } else {
                selectSquare(row, col);
            }
        }

        // Select square
        function selectSquare(row, col) {
            const algebraic = rowColToAlgebraic(row, col);
            const piece = chess.get(algebraic);
            
            if (piece && piece.color === chess.turn()) {
                selectedSquare = { row, col };
                
                // Highlight selected square
                const square = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                square.style.backgroundColor = '#667eea';
                square.style.boxShadow = 'inset 0 0 0 3px rgba(255,255,255,0.6)';
                
                console.log('Selected square:', algebraic, 'Piece:', piece);
            }
        }

        // Clear selection
        function clearSelection() {
            selectedSquare = null;
            
            // Reset square colors
            const squares = document.querySelectorAll('.square');
            squares.forEach((square, index) => {
                const row = Math.floor(index / 8);
                const col = index % 8;
                
                if ((row + col) % 2 === 0) {
                    square.style.backgroundColor = '#f0d9b5';
                } else {
                    square.style.backgroundColor = '#b58863';
                }
                square.style.boxShadow = 'none';
            });
        }

        // Make AI move
        function makeAIMove() {
            if (chess.isGameOver()) return;
            
            const moves = chess.moves({ verbose: true });
            if (moves.length === 0) return;
            
            const randomMove = moves[Math.floor(Math.random() * moves.length)];
            
            try {
                const move = chess.move(randomMove);
                
                if (move) {
                    console.log('AI move:', move);
                    gameStats.totalMoves++;
                    
                    if (move.captured) {
                        gameStats.captures++;
                    }
                    
                    updatePieces();
                    updateDisplay();
                }
            } catch (error) {
                console.error('AI move error:', error);
            }
        }

        // Update display
        function updateDisplay() {
            const turn = chess.turn() === 'w' ? 'White' : 'Black';
            document.getElementById('currentTurn').textContent = turn;
            document.getElementById('totalMoves').textContent = gameStats.totalMoves;
            document.getElementById('captures').textContent = gameStats.captures;
            
            const elapsed = Math.floor((Date.now() - gameStats.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('gameTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // Bind events
        function bindEvents() {
            document.getElementById('newGameBtn').addEventListener('click', () => {
                chess.reset();
                gameStats = {
                    totalMoves: 0,
                    captures: 0,
                    checks: 0,
                    startTime: Date.now()
                };
                clearSelection();
                updatePieces();
                updateDisplay();
            });

            document.getElementById('flipBoardBtn').addEventListener('click', () => {
                const board = document.getElementById('chessBoard');
                if (board.style.transform === 'rotate(180deg)') {
                    board.style.transform = 'rotate(0deg)';
                    document.querySelectorAll('.piece').forEach(piece => {
                        piece.style.transform = 'rotate(0deg)';
                    });
                } else {
                    board.style.transform = 'rotate(180deg)';
                    document.querySelectorAll('.piece').forEach(piece => {
                        piece.style.transform = 'rotate(180deg)';
                    });
                }
            });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, initializing game...');
            initGame();
            
            // Update timer every second
            setInterval(updateDisplay, 1000);
        });
    </script>
</body>
</html>